import { action } from "./_generated/server";
import { v } from "convex/values";

interface CurrencyInfo {
  code: string;
  name: string;
  country: string;
  flag: string;
}

/**
 * Manual currency data for common currencies
 * Since we can't rely on external packages in Convex actions,
 * we'll maintain a curated list of major currencies
 */
function getCurrencyDataMap(): Record<string, CurrencyInfo> {
  return {
    // Major world currencies
    USD: { code: "USD", name: "US Dollar", country: "United States", flag: "ðŸ‡ºðŸ‡¸" },
    EUR: { code: "EUR", name: "Euro", country: "Germany", flag: "ðŸ‡ªðŸ‡º" },
    GBP: { code: "GBP", name: "British Pound", country: "United Kingdom", flag: "ðŸ‡¬ðŸ‡§" },
    JPY: { code: "JPY", name: "Japanese Yen", country: "Japan", flag: "ðŸ‡¯ðŸ‡µ" },
    CHF: { code: "CHF", name: "Swiss Franc", country: "Switzerland", flag: "ðŸ‡¨ðŸ‡­" },
    CAD: { code: "CAD", name: "Canadian Dollar", country: "Canada", flag: "ðŸ‡¨ðŸ‡¦" },
    AUD: { code: "AUD", name: "Australian Dollar", country: "Australia", flag: "ðŸ‡¦ðŸ‡º" },
    CNY: { code: "CNY", name: "Chinese Yuan", country: "China", flag: "ðŸ‡¨ðŸ‡³" },
    INR: { code: "INR", name: "Indian Rupee", country: "India", flag: "ðŸ‡®ðŸ‡³" },
    BRL: { code: "BRL", name: "Brazilian Real", country: "Brazil", flag: "ðŸ‡§ðŸ‡·" },
    RUB: { code: "RUB", name: "Russian Ruble", country: "Russia", flag: "ðŸ‡·ðŸ‡º" },
    KRW: { code: "KRW", name: "South Korean Won", country: "South Korea", flag: "ðŸ‡°ðŸ‡·" },

    // Middle East & Africa
    AED: { code: "AED", name: "UAE Dirham", country: "United Arab Emirates", flag: "ðŸ‡¦ðŸ‡ª" },
    SAR: { code: "SAR", name: "Saudi Riyal", country: "Saudi Arabia", flag: "ðŸ‡¸ðŸ‡¦" },
    ZAR: { code: "ZAR", name: "South African Rand", country: "South Africa", flag: "ðŸ‡¿ðŸ‡¦" },
    EGP: { code: "EGP", name: "Egyptian Pound", country: "Egypt", flag: "ðŸ‡ªðŸ‡¬" },
    NGN: { code: "NGN", name: "Nigerian Naira", country: "Nigeria", flag: "ðŸ‡³ðŸ‡¬" },

    // Asia Pacific
    SGD: { code: "SGD", name: "Singapore Dollar", country: "Singapore", flag: "ðŸ‡¸ðŸ‡¬" },
    HKD: { code: "HKD", name: "Hong Kong Dollar", country: "Hong Kong", flag: "ðŸ‡­ðŸ‡°" },
    THB: { code: "THB", name: "Thai Baht", country: "Thailand", flag: "ðŸ‡¹ðŸ‡­" },
    MYR: { code: "MYR", name: "Malaysian Ringgit", country: "Malaysia", flag: "ðŸ‡²ðŸ‡¾" },
    IDR: { code: "IDR", name: "Indonesian Rupiah", country: "Indonesia", flag: "ðŸ‡®ðŸ‡©" },
    PHP: { code: "PHP", name: "Philippine Peso", country: "Philippines", flag: "ðŸ‡µðŸ‡­" },
    VND: { code: "VND", name: "Vietnamese Dong", country: "Vietnam", flag: "ðŸ‡»ðŸ‡³" },

    // Americas
    MXN: { code: "MXN", name: "Mexican Peso", country: "Mexico", flag: "ðŸ‡²ðŸ‡½" },
    ARS: { code: "ARS", name: "Argentine Peso", country: "Argentina", flag: "ðŸ‡¦ðŸ‡·" },
    CLP: { code: "CLP", name: "Chilean Peso", country: "Chile", flag: "ðŸ‡¨ðŸ‡±" },
    COP: { code: "COP", name: "Colombian Peso", country: "Colombia", flag: "ðŸ‡¨ðŸ‡´" },
    PEN: { code: "PEN", name: "Peruvian Sol", country: "Peru", flag: "ðŸ‡µðŸ‡ª" },

    // Europe
    NOK: { code: "NOK", name: "Norwegian Krone", country: "Norway", flag: "ðŸ‡³ðŸ‡´" },
    SEK: { code: "SEK", name: "Swedish Krona", country: "Sweden", flag: "ðŸ‡¸ðŸ‡ª" },
    DKK: { code: "DKK", name: "Danish Krone", country: "Denmark", flag: "ðŸ‡©ðŸ‡°" },
    PLN: { code: "PLN", name: "Polish Zloty", country: "Poland", flag: "ðŸ‡µðŸ‡±" },
    CZK: { code: "CZK", name: "Czech Koruna", country: "Czech Republic", flag: "ðŸ‡¨ðŸ‡¿" },
    HUF: { code: "HUF", name: "Hungarian Forint", country: "Hungary", flag: "ðŸ‡­ðŸ‡º" },
    RON: { code: "RON", name: "Romanian Leu", country: "Romania", flag: "ðŸ‡·ðŸ‡´" },
    BGN: { code: "BGN", name: "Bulgarian Lev", country: "Bulgaria", flag: "ðŸ‡§ðŸ‡¬" },
    HRK: { code: "HRK", name: "Croatian Kuna", country: "Croatia", flag: "ðŸ‡­ðŸ‡·" },
    TRY: { code: "TRY", name: "Turkish Lira", country: "Turkey", flag: "ðŸ‡¹ðŸ‡·" },

    // Cryptocurrencies (if needed)
    BTC: { code: "BTC", name: "Bitcoin", country: "Digital", flag: "â‚¿" },
    ETH: { code: "ETH", name: "Ethereum", country: "Digital", flag: "âŸ " },

    // Other important currencies
    NZD: { code: "NZD", name: "New Zealand Dollar", country: "New Zealand", flag: "ðŸ‡³ðŸ‡¿" },
    ILS: { code: "ILS", name: "Israeli Shekel", country: "Israel", flag: "ðŸ‡®ðŸ‡±" },
    QAR: { code: "QAR", name: "Qatari Riyal", country: "Qatar", flag: "ðŸ‡¶ðŸ‡¦" },
    KWD: { code: "KWD", name: "Kuwaiti Dinar", country: "Kuwait", flag: "ðŸ‡°ðŸ‡¼" },
    BHD: { code: "BHD", name: "Bahraini Dinar", country: "Bahrain", flag: "ðŸ‡§ðŸ‡­" },
    OMR: { code: "OMR", name: "Omani Rial", country: "Oman", flag: "ðŸ‡´ðŸ‡²" },
    JOD: { code: "JOD", name: "Jordanian Dinar", country: "Jordan", flag: "ðŸ‡¯ðŸ‡´" },
    LBP: { code: "LBP", name: "Lebanese Pound", country: "Lebanon", flag: "ðŸ‡±ðŸ‡§" },
  };
}

/* Get currency information by code for auto-filling forms */
export const getCurrencyInfo = action({
  args: {
    code: v.string()
  },
  returns: v.union(
    v.object({
      found: v.literal(true),
      data: v.object({
        code: v.string(),
        name: v.string(),
        country: v.string(),
        flag: v.string(),
      })
    }),
    v.object({
      found: v.literal(false),
      message: v.string(),
    })
  ),
  handler: async (ctx, args) => {
    const currencyCode = args.code.toUpperCase();
    const currencyData = getCurrencyDataMap();
    const currencyInfo = currencyData[currencyCode];

    if (currencyInfo) {
      return {
        found: true as const,
        data: currencyInfo
      };
    }

    return {
      found: false as const,
      message: `Currency code "${currencyCode}" not found. Please enter details manually.`
    };
  },
});